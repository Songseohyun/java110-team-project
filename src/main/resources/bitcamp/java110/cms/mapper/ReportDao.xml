<?xml version="1.0" encoding="UTF-8"?>

<!-- reportDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java110.cms.dao.ReportDao">

	<resultMap type="report" id="reportMap">
		<id column="rtno"         property="no" />
		<result column="titl"     property="titl" />
		<result column="conts"    property="conts" />
		<result column="url"      property="url" />
		<result column="type"     property="type" />
		<result column="type_detail" property="type_detail"/>
		<result column="rtdt"     property="rtdt" />
	    <result column="meno"     property="meno" />	
        <result column="meno2"    property="meno2" />
  
        <result column="metenick" property="menteeNick" />
        <result column="mete2name" property="mentee2Name" />
        <result column="mete2nick" property="mentee2Nick" />
	</resultMap>

	<sql id="select1">
		SELECT
		rtno,
		titl,
		conts,
		url,
		type,
		rtdt,
		meno,
		meno2
		FROM
		p_rept
	</sql>
	
	<select id="findAll" resultMap="reportMap" parameterType="map">
        SELECT
            rtno,
            titl,
            conts,
            url,
            type,
            type_detail,
            rtdt,
            r.meno,
            r.meno2
        FROM
            p_rept as rept inner join p_mete as mete
            on rept.meno = mete.meno
        order by 
            rtno DESC
        
    </select>
	
	

	<select id="findFinishAll" resultMap="reportMap" parameterType="map">
        SELECT
            rtno,
            titl,
            conts,
            url,
            type,
            type_detail,
            rtdt,
            r.meno,
            r.meno2
        FROM
            p_rept r
            join p_mete mete
            join p_mete mete2
        WHERE
            r.meno = mete.meno AND
            r.meno2 = mete2.meno AND
            r.stat='Y'
	</select>

	<select id="findByNo" resultMap="reportMap"
		parameterType="int">
        <include refid="select1"></include>
        where
        rtno=#{value}

	</select>

	<select id="findByMeno2Cnt" resultType="int" parameterType="int">
        select
            count(meno2)
        from
            p_rept
        where
            meno2=#{value}
	</select>

	<select id="findByMeno" resultMap="reportMap"
		parameterType="int">
		<include refid="select1"></include>
		where
		meno=#{value}
	</select>

	<insert id="insert" parameterType="report"
		useGeneratedKeys="true" keyColumn="rtno" keyProperty="no">

		INSERT INTO
		p_rept(titl, conts, url, type, rtdt, meno2, meno)
		VALUES(#{titl},#{conts},#{url},#{type},now(),#{meno},#{meno2})

	</insert>


    
    
	<update id="update" parameterType="report">
		update p_rept
		<set>
			<if test="titl!=null">titl= #{titl},</if>
			<if test="conts!=null">conts= #{conts},</if>
			<if test="url!=null">url= #{url},</if>
			<if test="type!=null">type= #{type},</if>
			<if test="meno>0">meno= #{meno},</if>
			<if test="meno2>0">meno2= #{meno2},</if>

		</set>
		where
		rtno=#{no}
	</update>

</mapper>
