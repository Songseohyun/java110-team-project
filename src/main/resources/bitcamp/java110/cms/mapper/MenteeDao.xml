<?xml version="1.0" encoding="UTF-8"?>

<!-- BigTagDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java110.cms.dao.MenteeDao">

   
    <resultMap type="mentee" id="menteeMap">
        <id column="meno"        property="no"/>
        <result column="name"   property="name"/>
        <result column="email"   property="email"/>
        <result column="pwd"   property="pwd"/>
        <result column="nick"   property="nick"/>
        <result column="phone"   property="phone"/>
        <result column="pstno"   property="pstno"/>
        <result column="bas_addr"   property="bas_addr"/>
        <result column="det_addr"   property="det_addr"/>
        <result column="phot"   property="phot"/>
        <result column="sell"   property="sell"/>
        <result column="bkname"   property="bkname"/>
        <result column="bkno"   property="bkno"/>
        <result column="rgdt"   property="rgdt"/>
        <result column="stat"   property="stat"/>
        <result column="note"   property="note"/>
        <result column="mtstat"   property="mtstat"/>
        <result column="mono"   property="classes.mono"/>
        <result column="titl"   property="classes.titl"/>
        <result column="pric"   property="classes.pric"/>
    </resultMap>
    
    <select id="checkemail"
    parameterType="Mentee"
    resultType="java.lang.Integer">
    SELECT COUNT(*)
    FROM p_mete p WHERE p.email=#{email}
	</select>
	
	<select id="checknick"
    parameterType="Mentee"
    resultType="java.lang.Integer">
    SELECT COUNT(*)
    FROM p_mete p WHERE p.nick=#{nick}
	</select>
	
	<select id="findByNamePhone" parameterType="Mentee" resultType="String">
			select
				email
			from
				p_mete p
			where
				p.phone=#{phone} and
				p.name=#{name}
				
	</select>
    
    <select id="findAll" resultMap="menteeMap">
        select
            meno,
            name,
            email,
            pwd,
            nick,
            phone,
            pstno,
            bas_addr,
            det_addr,
            phot,
            sell,
            bkname,
            bkno,
            rgdt,
            stat,
            note,
            mtstat
        from 
            p_mete
        order by 
            meno asc
    </select>

    <select id="findByNo" 
            resultMap="menteeMap" parameterType="int">
        select
            meno,
            name,
            email,
            pwd,
            nick,
            phone,
            pstno,
            bas_addr,
            det_addr,
            phot,
            sell,
            bkname,
            bkno,
            rgdt,
            stat,
            note
        from
            p_mete
        where 
            meno=#{value}
    </select>
    
    
    <select id="findM2ByNo" 
            resultMap="menteeMap" parameterType="int">
        SELECT  c.titl, c.mono,c.pric
        FROM    p_mete m INNER JOIN p_cls_order co ON m.meno = co.meno
                INNER JOIN p_cls_ttab ct on co.ctno = ct.ctno
                INNER JOIN p_cls c on ct.cno = c.cno
        WHERE
                m.meno=#{value}
    </select>
    
    <select id="findAllByEmail" parameterType="String">
        select
            email
        from
            p_mete
        where 
            email=#{email}
    </select>
    
    
    <select id="findAllByNick" 
            resultMap="menteeMap" parameterType="Map">
        select
            meno,
            name,
            email,
            pwd,
            nick,
            phone,
            pstno,
            bas_addr,
            det_addr,
            phot,
            sell,
            bkname,
            bkno,
            rgdt,
            stat,
            note
        from
            p_mete
        where 
            nick=#{paramNick}
    </select>
    
    <select id="findAllByPhone" 
            resultMap="menteeMap" parameterType="Map">
        select
            meno,
            name,
            email,
            pwd,
            nick,
            phone,
            pstno,
            bas_addr,
            det_addr,
            phot,
            sell,
            bkname,
            bkno,
            rgdt,
            stat,
            note
        from
            p_mete
        where 
            phone=#{paramPhone}
    </select>
    
    <insert id="signup" parameterType="mentee"
            useGeneratedKeys="true" keyColumn="meno" keyProperty="no">
        insert into p_mete(name,email,pwd,nick,rgdt)
        values(#{name},#{email},#{pwd},#{nick},now())
    </insert> 
    
    <insert id="fbsignup" parameterType="mentee"
            useGeneratedKeys="true" keyColumn="meno" keyProperty="no">
        insert into p_mete(name,email,nick,rgdt)
        values(#{name},#{email},#{nick},now())
    </insert> 
    
    <delete id="delete" parameterType="int">
        delete from p1_memb 
        where mno=#{value}
    </delete>
    
    
    
    <select id="findByEmailPassword" 
            resultMap="menteeMap" parameterType="map">
        select 
            meno,
            name,
            email,
            nick,
            phone,
            pstno,
            bas_addr,
            det_addr,
            phot,
            sell,
            bkname,
            bkno,
            rgdt,
            stat,
            note,
            mtstat
        from 
            p_mete mte
        where
            LOWER(mte.email)=#{email} and LOWER(mte.pwd)=#{pwd}
            <!-- mte.email=#{email} and mte.pwd=password(#{pwd}) -->
    </select> 
    
    <select id="findMentorRequest" resultMap="menteeMap">
        select
            *
        from 
            p_mete
        where
            mtstat='I'
        order by 
            meno asc
    </select>
    
</mapper>
