<?xml version="1.0" encoding="UTF-8"?>
<!-- MemberDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java110.cms.dao.ClassDao">

    <resultMap type="Classes" id="classMap">
        <id column="cno" property="no"/>
        <result column="titl"  property="titl"/>
        <result column="conts"    property="conts"/>
        <result column="pric"   property="pric"/>
        <result column="rgdt"   property="rgdt"/>
        <result column="time"   property="time"/>
        <result column="capa"  property="capa"/>
        <result column="cfile"  property="cfile"/>
        <result column="tinfo"    property="tinfo"/>
        <result column="cinfo"   property="cinfo"/>
        <result column="pstno"   property="pstno"/>
        <result column="bas_addr"   property="basAddr"/>
        <result column="det_addr"   property="detAddr"/>
        <result column="edt"  property="edt"/>
        <result column="mono"  property="mono"/>
        <result column="mtno"  property="mtno"/>
    </resultMap>
    
    <sql id="select1">
    	select 
			ps.cno,ps.titl,ps.pric,ps.bas_addr,pg.mtno,pe.meno
		from
			p_cls as ps inner join p_mete as pe 
				on ps.mono = pe.meno
			inner join p_mtag as pg 
				on ps.mtno = pg.mtno
    </sql>

    <select id="findAll" resultMap="classMap" parameterType="map">
        <include refid="select1"></include>
		order by
			cno asc;
    </select>

	<select id="findBytag" resultMap="classMap" parameterType="int">
		<include refid="select1"></include>
		where pg.mtno = #{mtno}
	</select>
	
	<select id ="findByba" resultMap="classMap" parameterType="String">
		<include refid="select1"></include>
		where bas_addr = #{bas_addr}
	</select>
    
    <insert id="classinsert" parameterType="Classes"
    useGeneratedKeys="true" keyColumn="cno" keyProperty="no">
        insert 
        	into p_cls(titl,conts,pric,rgdt,time,capa,cfile
        	,tinfo,cinfo,pstno,bas_addr,det_addr,edt,mono,mtno)
        values
        	(#{titl},#{conts},#{pric},now(),#{time},#{capa}
        	,#{cfile},#{tinfo},#{cinfo},#{pstno},#{basAddr}
        	,#{detAddr},now(),#{mono},#{mtno})
    </insert> 
    
    <update id="classupdate" parameterType="Classes">
    	update p_cls
    		<set>
    			<if test="titl != null">titl = #{titl},</if>
    			<if test="conts != null">conts = #{conts},</if>
    			<if test="pric > 0">pric = #{pric},</if>
    			<if test="rgdt != null">rgdt = now(),</if>
    			<if test="time != null">time = #{time},</if>
    			<if test="capa > 0">capa = #{capa},</if>
    			<if test="cfile != null">cfile = #{cfile},</if>
    			<if test="tinfo != null">tinfo = #{tinfo},</if>
    			<if test="cinfo != null">cinfo = #{cinfo},</if>
    			<if test="pstno != null">pstno = #{pstno},</if>
    			<if test="basAddr != null">bas_addr = #{basAddr},</if>
    			<if test="detAddr != null">det_addr = #{detAddr},</if>
    			<if test="edt != null">edt = now(),</if>
    			<if test="mono > 0">mono = #{mono},</if>
    			<if test="mtno > 0">mtno = #{mtno}</if>
    		</set>
    	where 
    		cno = #{no}
    </update>
    
</mapper>









