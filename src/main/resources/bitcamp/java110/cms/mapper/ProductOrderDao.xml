<?xml version="1.0" encoding="UTF-8"?>

<!-- BigTagDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java110.cms.dao.ProductOrderDao">

    <resultMap type="productOrder" id="productOrderMap">
        <id column="ono"        property="no"/>
        <result column="meno"   property="meno"/>
        <result column="ptno"   property="ptno"/>
        <result column="cnt"   property="cnt"/>
        <result column="tot_pric"   property="tot_pric"/>
        <result column="payopt"   property="payopt"/>
        <result column="paydt"   property="paydt"/>
        <result column="parc_name"   property="parc_name"/>
        <result column="parc_no"   property="parc_no"/>
        
        <result column="ptitl"   property="product.titl"/>
        <result column="sellernick"   property="sellernick"/>
        <result column="pphot"   property="product.phot"/>
        <result column="pptno"   property="product.no"/>
        
        <result column="stname" property="stname"/>
        <result column="titl" property="prdt_titl"/>
        <result column="nick" property="mete_nick"/>
        <result column="name1" property="mete_name"/>
        <result column="nick2" property="mete2_nick"/>
         <result column="name2" property="mete2_name"/>
        <result column="pric" property="prdt_pric"/>
        <result column="phone" property="mete2_phone"/>
 
        
        
    </resultMap>
    
    <select id="findAll" resultMap="productOrderMap">
        select
            ono,
            meno,
            ptno,
            cnt,
            tot_pric,
            payopt,
            paydt,
            parc_name,
            parc_no
        from 
            p_prdt_order
        order by 
            ono asc
    </select>

    
    <select id="findAllMaster" resultMap="productOrderMap">
    
    <!--
    select 
            stag.stname,
            prdt.titl, 
            mete.nick,
            mete2.nick,
            prdt.pric, 
            paydt,
            porder.ono
        from
            p_prdt_order as porder 
            inner join p_prdt as prdt 
            inner join p_stag as stag
            inner join p_mete as mete
            inner join p_cert as cert
            inner join p_mete as mete2
        
            on prdt.ptno = porder.ptno and
             prdt.stno = stag.stno AND
             porder.meno = mete.meno and
             mete2.meno = cert.meno and
             prdt.ctno = cert.ctno
        order by 
            ono asc
    
      -->
        select 
	        stag.stname,
	        prdt.titl, 
	        mete.nick nick,
            mete.name name1, <!-- 구매자-->
	        mete2.nick nick2,
            mete2.name name2,
            mete2.phone,
            porder.cnt,
	        prdt.pric,
            porder.payopt,
	        porder.paydt,
	        porder.ono,
            parc_name,
            parc_no
            
		from
		    p_prdt_order as porder 
		    inner join p_prdt as prdt 
		    inner join p_stag as stag
		    inner join p_mete as mete
		    inner join p_cert as cert
		    inner join p_mete as mete2
		
		    on prdt.ptno = porder.ptno and
		     prdt.stno = stag.stno AND
		     porder.meno = mete.meno and
		     mete2.meno = cert.meno and
		     prdt.ctno = cert.ctno
        order by 
            ono asc
    </select>

    <select id="findByMeno" 
            resultMap="productOrderMap" parameterType="map">
       SELECT
            po.paydt,
            po.payopt,
            po.tot_pric,
            po.parc_name,
            po.parc_no,
            po.tot_pric,
            po.cnt,
            po.ptno,
            p.titl as ptitl,
            p.ptno as pptno,
            me2.nick as sellernick,
            p.phot as pphot
         FROM
            p_prdt_order po
            JOIN p_mete me on po.meno = me.meno
            JOIN p_prdt p ON po.ptno = p.ptno
            JOIN p_mete me2 ON p.meno = me2.meno 
        where
            me.meno=#{meno}
    </select>
    
    <select id="findAllByMeno" 
            resultMap="productOrderMap" parameterType="Map">
        select
            ono,
            meno,
            ptno,
            cnt,
            tot_pric,
            payopt,
            paydt,
            parc_name,
            parc_no
        from
            p_prdt_order
        where 
            meno=#{mentno}
    </select>
    
    
    <select id="findAllByPtno" 
            resultMap="productOrderMap" parameterType="Map">
        select
            ono,
            meno,
            ptno,
            cnt,
            tot_pric,
            payopt,
            paydt,
            parc_name,
            parc_no
        from
            p_prdt_order
        where 
            ptno=#{productno}
    </select>
    
    <!-- insert -->
    <insert id="insert" parameterType="productOrder"
            useGeneratedKeys="true" keyColumn="ono" keyProperty="no">
        insert into p_prdt_order(meno,ptno,cnt,tot_pric,payopt,paydt,parc_name,parc_no)
        values(#{meno},#{ptno},#{cnt},#{tot_pric},#{payopt},now(),#{parc_name},#{parc_no})
    </insert> 
    

</mapper>
